<!DOCTYPE html>
<html lang="ms">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Borang Tempahan Pusat Digital SMANIP</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-blue-50 text-gray-900">
  <div class="max-w-4xl mx-auto my-10 p-6 bg-white rounded-2xl shadow-lg">
    <h1 class="text-2xl font-bold text-center text-blue-700 mb-6">
      üñ•Ô∏è Borang Tempahan Pusat Digital SMANIP
    </h1>

    <!-- BORANG TEMPAHAN -->
    <form id="bookingForm" class="space-y-4">
      <div>
        <label class="block font-semibold">Nama Guru:</label>
        <input id="namaGuru" type="text" class="w-full border rounded-lg p-2" required />
      </div>

      <div>
        <label class="block font-semibold">Matapelajaran / Kelas:</label>
        <input id="kelas" type="text" class="w-full border rounded-lg p-2" required />
      </div>

      <div>
        <label class="block font-semibold">Hari:</label>
        <select id="hari" class="w-full border rounded-lg p-2">
          <option>Isnin</option><option>Selasa</option><option>Rabu</option>
          <option>Khamis</option><option>Jumaat</option>
        </select>
      </div>

      <div>
        <label class="block font-semibold">Masa:</label>
        <input id="masa" type="text" placeholder="Contoh: 8.00 - 9.00 pagi" class="w-full border rounded-lg p-2" required />
      </div>

      <div>
        <label class="block font-semibold">Tujuan:</label>
        <textarea id="tujuan" rows="2" class="w-full border rounded-lg p-2" required></textarea>
      </div>

      <div>
        <label class="block font-semibold">Email:</label>
        <input id="email" type="email" class="w-full border rounded-lg p-2" placeholder="contoh@smanip.edu.my" />
      </div>

      <button type="submit" class="w-full bg-blue-700 text-white font-semibold py-2 rounded-lg hover:bg-blue-800">
        Hantar Tempahan
      </button>
    </form>

    <!-- PAPARAN JADUAL -->
    <h2 class="text-xl font-bold mt-10 mb-3 text-blue-700 text-center">üìÖ Jadual Tempahan Terkini</h2>
    <div class="overflow-x-auto">
      <table class="min-w-full border border-gray-300 text-sm text-center">
        <thead class="bg-blue-700 text-white">
          <tr>
            <th class="border px-2 py-1">ID</th>
            <th class="border px-2 py-1">Nama Guru</th>
            <th class="border px-2 py-1">Matapelajaran/Kelas</th>
            <th class="border px-2 py-1">Hari</th>
            <th class="border px-2 py-1">Masa</th>
            <th class="border px-2 py-1">Tujuan</th>
            <th class="border px-2 py-1">Email</th>
            <th class="border px-2 py-1">Tarikh Tempah</th>
            <th class="border px-2 py-1">Peranti</th>
          </tr>
        </thead>
        <tbody id="jadual" class="bg-white"></tbody>
      </table>
    </div>
  </div>

  <script>
    const SHEET_URL = "https://script.google.com/macros/s/AKfycbzY8D9CMxtYCM_rZcABxLlR8rusbs1BdO5fhjOG_3XlM17Mt6MLn4QpYL5ArlajtvLQjw/exec";

    // Hantar data ke Google Sheet
    async function sendData(e) {
      e.preventDefault();

      const namaGuru = document.getElementById("namaGuru").value;
      const kelas = document.getElementById("kelas").value;
      const hari = document.getElementById("hari").value;
      const masa = document.getElementById("masa").value;
      const tujuan = document.getElementById("tujuan").value;
      const email = document.getElementById("email").value;
      const peranti = navigator.userAgent; // automatik kesan jenis peranti

      const data = { namaGuru, kelas, hari, masa, tujuan, email, peranti };

      try {
        await fetch(SHEET_URL, {
          method: "POST",
          body: JSON.stringify(data),
          headers: { "Content-Type": "application/json" },
        });

        alert("‚úÖ Tempahan berjaya dihantar!");
        document.getElementById("bookingForm").reset();
        loadData(); // muat semula jadual
      } catch (err) {
        alert("‚ùå Ralat menghantar data: " + err);
      }
    }

    // Muat data dari Google Sheet
    async function loadData() {
      try {
        const res = await fetch(SHEET_URL);
        const data = await res.json();

        const table = document.getElementById("jadual");
        table.innerHTML = "";

        data.slice(1).reverse().forEach((row) => {
          const tr = document.createElement("tr");
          row.forEach((cell) => {
            const td = document.createElement("td");
            td.textContent = cell;
            td.classList.add("border", "px-2", "py-1");
            tr.appendChild(td);
          });
          table.appendChild(tr);
        });
      } catch (err) {
        console.error("Gagal muat data:", err);
      }
    }

    document.getElementById("bookingForm").addEventListener("submit", sendData);
    loadData();
    setInterval(loadData, 5000); // auto refresh setiap 5 saat
  </script>
</body>
</html>
